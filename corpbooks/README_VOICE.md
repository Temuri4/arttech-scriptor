# Голосовое управление в Arttech Scriptor

## Обзор

В Arttech Scriptor добавлена функциональность распознавания голосовых команд с использованием модели Whisper. Это позволяет пользователям взаимодействовать с системой, используя голосовые команды вместо текстового ввода.

## Возможности

- Распознавание голосовых команд из аудиофайлов
- Запись и распознавание голосовых команд с микрофона
- Интеллектуальное определение намерений пользователя при нечетких командах
- Интеграция с существующей системой обработки команд
- Fallback-механизм для неясных команд с использованием GPT

## Требования

Для работы с голосовыми командами необходимы следующие библиотеки:

```bash
pip install faster-whisper sounddevice numpy
```

## Использование

### Распознавание команд из аудиофайла

```bash
python arttech_scriptor.py --voice path/to/audio.wav
```

### Запись и распознавание команд с микрофона

```bash
python arttech_scriptor.py --mic 5  # запись 5 секунд
```

### Примеры голосовых команд

Система поддерживает как прямые команды, так и естественные фразы:

- "список компаний" → выполнит команду `/list`
- "информация о компании NIIPH" → выполнит команду `/info NIIPH`
- "покажи дедлайны" → выполнит команду `/deadlines`
- "задай вопрос о технологиях ASIZ" → выполнит команду `/ask ASIZ технологии`

## Технические детали

### Архитектура

1. **Ленивая инициализация модели Whisper**
   - Модель загружается только при первом использовании
   - Используется "tiny" модель для быстрой работы на CPU

2. **Преобразование аудио в текст**
   - Функция `transcribe_audio()` обрабатывает аудиофайл и возвращает распознанный текст
   - Поддерживается русский язык по умолчанию

3. **Запись с микрофона**
   - Функция `record_audio()` записывает аудио с микрофона и сохраняет во временный файл
   - Поддерживаются различные параметры записи (длительность, частота дискретизации)

4. **Обработка неясных команд**
   - Если команда не распознана, используется GPT для уточнения намерения пользователя
   - Функция `clarify_command()` предлагает наиболее вероятную команду

### Интеграция с существующей системой

Голосовые команды интегрированы с существующей системой обработки команд:
- Распознанный текст передается в функцию `process_command()`
- Если команда не начинается с "/", система пытается определить намерение пользователя
- Для неясных команд используется fallback-механизм с GPT

## Тестирование

Для тестирования функциональности голосовых команд создан скрипт `test_voice.py`:

```bash
python test_voice.py
```

Тесты проверяют:
- Корректность распознавания аудио
- Обработку прямых команд
- Обработку команд на естественном языке
- Механизм обработки неизвестных команд

## Ограничения и дальнейшие улучшения

### Текущие ограничения

- Требуется хорошее качество аудио для точного распознавания
- Модель "tiny" имеет ограниченную точность, но работает быстро
- Распознавание работает только для русского языка

### Планы по улучшению

- Добавление поддержки нескольких языков
- Улучшение распознавания специфических терминов и названий компаний
- Оптимизация производительности для более быстрого отклика
- Добавление потоковой обработки аудио в реальном времени
- Расширение возможностей интерпретации естественного языка
